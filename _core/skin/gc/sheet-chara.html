<!DOCTYPE html>
<html lang="ja">

<head>
<TMPL_INCLUDE NAME="../_common/sheet-head.html">
</head>
<body>
  <header>
    <h1><a href="./"><TMPL_VAR title></a></h1>
    <nav>
      <ul>
        <TMPL_LOOP Menu><li class="<TMPL_VAR SIZE>"><a <TMPL_VAR TYPE>="<TMPL_VAR VALUE>"><TMPL_VAR TEXT></a>
        </TMPL_LOOP>
        <li><a onclick="nightModeChange()" class="nightmode-icon" title="ナイトモード"></a>
      </ul>
    </nav>
    <script>
      const stt = {
        Str : <TMPL_VAR sttStrCheckTotal DEFAULT="0" />,
        Ref : <TMPL_VAR sttRefCheckTotal DEFAULT="0" />,
        Per : <TMPL_VAR sttPerCheckTotal DEFAULT="0" />,
        Int : <TMPL_VAR sttIntCheckTotal DEFAULT="0" />,
        Mnd : <TMPL_VAR sttMndCheckTotal DEFAULT="0" />,
        Emp : <TMPL_VAR sttEmpCheckTotal DEFAULT="0" />,
        Hp  : <TMPL_VAR sttHpTotal       DEFAULT="0" />,
        Init: <TMPL_VAR sttInitTotal     DEFAULT="0" />,
        Move: <TMPL_VAR sttMoveTotal     DEFAULT="0" />,
        DefW: <TMPL_VAR armorTotalDefWeapon   DEFAULT="0" />,
        DefF: <TMPL_VAR armorTotalDefFire     DEFAULT="0" />,
        DefS: <TMPL_VAR armorTotalDefShock    DEFAULT="0" />,
        DefI: <TMPL_VAR armorTotalDefInternal DEFAULT="0" />,
      };
      let hasForceMod = false;
      function setForceMod(){
        hasForceMod = document.querySelector("#force-mod-check input").checked;
        
        if(!document.querySelector(`input[name="forceLead"]:checked`)) return;
        
        let center = document.getElementById("force-position").value == 'センター' ? 1 : 0;
        document.body.classList.toggle('has-force-mod', hasForceMod);
        document.body.classList.toggle('position-center', center);
        document.getElementById("force-position").style.backgroundColor = center ? "#0c03":"#d703"

        const selected = document.querySelector(`input[name="forceLead"]:checked`).value || 1;
        const row = document.querySelector(`#force${selected}`);

        const fStt = {
          Str  :Number(row.querySelector('.str ').textContent.trim() || 0),
          Ref  :Number(row.querySelector('.ref ').textContent.trim() || 0),
          Per  :Number(row.querySelector('.per ').textContent.trim() || 0),
          Int  :Number(row.querySelector('.int ').textContent.trim() || 0),
          Mnd  :Number(row.querySelector('.mnd ').textContent.trim() || 0),
          Emp  :Number(row.querySelector('.emp ').textContent.trim() || 0),
          Hp   :Number(row.querySelector('.hp  ').textContent.trim() || 0),
          Init :Number(row.querySelector('.init').textContent.trim() || 0),
          Move :Number(row.querySelector('.move').textContent.trim() || 0),
          Atk  :Number(row.querySelector('.atk ').textContent.trim() || 0),
          DefW :Number(row.querySelector('.defw').textContent.trim() || 0),
          DefF :Number(row.querySelector('.deff').textContent.trim() || 0),
          DefS :Number(row.querySelector('.defs').textContent.trim() || 0),
          DefI :Number(row.querySelector('.defi').textContent.trim() || 0),
        }
        level = Number(row.querySelector('.lv  ').textContent.trim() || 0);

        document.getElementById("str-check-value").textContent = hasForceMod ? stt.Str+fStt.Str-center : stt.Str;
        document.getElementById("ref-check-value").textContent = hasForceMod ? stt.Ref+fStt.Ref-center : stt.Ref;
        document.getElementById("per-check-value").textContent = hasForceMod ? stt.Per+fStt.Per-center : stt.Per;
        document.getElementById("int-check-value").textContent = hasForceMod ? stt.Int+fStt.Int-center : stt.Int;
        document.getElementById("mnd-check-value").textContent = hasForceMod ? stt.Mnd+fStt.Mnd-center : stt.Mnd;
        document.getElementById("emp-check-value").textContent = hasForceMod ? stt.Emp+fStt.Emp-center : stt.Emp;
        document.querySelector("#hp   b").textContent = hasForceMod ? stt.Hp+fStt.Hp+(center?level*10:0) : stt.Hp;
        document.querySelector("#init b").textContent = hasForceMod ? stt.Init+fStt.Init : stt.Init;
        document.querySelector("#move b").textContent = hasForceMod ? stt.Move+fStt.Move : stt.Move;
        if(hasForceMod) {
          const atk = fStt.Atk+(center?-5:0);
          if(!document.querySelector("#weapon-row-Total .atk .f-mod")){
            document.querySelector("#weapon-row-Total .atk").innerHTML += `<span class="f-mod"></span>`;
          }
          document.querySelector("#weapon-row-Total .atk .f-mod").textContent = atk < 0 ? atk : `+${atk}`;
          const defC = center ? level*2 : 0;
          console.log(defC)
          document.querySelector("#armor-row-Total .def span:nth-child(1)").textContent = stt.DefW+fStt.DefW+defC;
          document.querySelector("#armor-row-Total .def span:nth-child(2)").textContent = stt.DefF+fStt.DefF+defC;
          document.querySelector("#armor-row-Total .def span:nth-child(3)").textContent = stt.DefS+fStt.DefS+defC;
          document.querySelector("#armor-row-Total .def span:nth-child(4)").textContent = stt.DefI+fStt.DefI+defC;
          document.querySelectorAll(".f-mod.check").forEach(span => {
            if(span.dataset.stt){
              const value = fStt[span.dataset.stt]-center;
              span.textContent = value < 0 ? value : `+${value}`;
            }
            else { span.textContent = '' }
          });
          document.querySelectorAll(".f-mod.dmg").forEach(span => {
            span.textContent = atk < 0 ? atk : `+${atk}`;
          });
        }
        else {
          document.querySelector("#weapon-row-Total .atk .f-mod").remove();
          document.querySelector("#armor-row-Total .def span:nth-child(1)").textContent = stt.DefW;
          document.querySelector("#armor-row-Total .def span:nth-child(2)").textContent = stt.DefF;
          document.querySelector("#armor-row-Total .def span:nth-child(3)").textContent = stt.DefS;
          document.querySelector("#armor-row-Total .def span:nth-child(4)").textContent = stt.DefI;
          document.querySelectorAll(".f-mod").forEach(span => { span.textContent = "" });
        }
        
      }
    </script>
  </header>
  <div class="header-back-name"><TMPL_VAR titleName> - <TMPL_VAR title></div>
  
  <TMPL_IF error>
  <aside id="error">
    <p>
      <TMPL_VAR error>
    </p>
  </aside>
  </TMPL_IF>
  
  <TMPL_UNLESS modeDownload>
    <TMPL_UNLESS forbiddenMode>
      <aside id="loglist" class="float-box">
        <h2>過去ログ（バックアップ）</h2>
        <ul>
          <TMPL_LOOP LogList><li class="<TMPL_VAR SELECTED>"><a href="?id=<TMPL_VAR id><TMPL_VAR URL>"><TMPL_VAR DATE></a></TMPL_LOOP>
        </ul>
        <TMPL_IF viewLogNaming><details id="log-naming">
          <summary>閲覧中のログ<TMPL_IF selectedLogName>の名前をつけなおす<TMPL_ELSE>に名前をつける</TMPL_IF></summary>
          <form id="log-naming-form" method="post" action="./">
            <input type="hidden" name="mode" value="bu-naming">
            <input type="hidden" name="id" value="<TMPL_VAR id>">
            <input type="hidden" name="date" value="<TMPL_VAR logId>">
            <dl>
              <dt>名前<dd><input type="text" name="log-name" value="<TMPL_VAR selectedLogName>">
              <TMPL_IF reqdPassword><dt>パスワード<dd><input type="password" name="pass"></TMPL_IF>
              <dd><input type="submit" value="命名">
            </dl>
          </form>
        </details></TMPL_IF>
      </aside>

      <aside id="downloadlist" class="float-box">
        <h2>出力</h2>
        <ul>
          <li id="downloadlist-udonarium"><a onclick="downloadAsUdonarium();">ユドナリウム用コマデータ<small>(zip形式ファイル)</small></a>
          <li id="downloadlist-ccfolia"><a onclick="downloadAsCcfolia();">ココフォリア用コマデータ<small>(クリップボードへコピー)</small></a>
          <!-- 
          <li id="downloadlist-text"><a onclick="downloadAsText();">テキスト形式</a>
           -->
          <li id="downloadlist-json"><a onclick="downloadAsJson();">JSON 形式</a>
          <li id="downloadlist-html"><a onclick="downloadAsHtml();">HTML 形式</a>
          <li id="downloadlist-zipped"><a onclick="downloadAsFullSet();">ZIP 形式（上記全部入り）</a>
          <li class="link-tag"><span>ゆとシート内リンク用タグ<br><input type="text" onclick="this.select()" value="[<TMPL_VAR rawName>#<TMPL_VAR id>]"></span>
        </ul>
      </aside>
    </TMPL_UNLESS>

    <form id="login-form" class="float-box" method="post" action="./">
      <input type="hidden" name="mode" value="edit">
      <input type="hidden" name="id" value="<TMPL_VAR id>">
      <input type="password" name="pass" placeholder="password">
      <input type="hidden" name="log" value="<TMPL_VAR logId>">
      <input type="submit" value="編集">
    </form>
  </TMPL_UNLESS>

  <main id="character">
    <TMPL_IF forbidden><aside class="information attention">
      閲覧が制限されているデータです。<br>
      <TMPL_IF yourAuthor>あなた以外には一部または全てのデータが伏せられます。(<a href="./?id=<TMPL_VAR id>&checkView=1">⇒確認</a>)</TMPL_IF>
    </aside></TMPL_IF>
    
    <TMPL_IF logId><aside class="information log">
      <h2><TMPL_VAR selectedLogName></h2>
      <p><TMPL_VAR updateTime> 時点の過去ログ(バックアップ)データです。</p>
    </aside></TMPL_IF>
    
    <TMPL_IF convertMode><aside class="information">
      <a href="<TMPL_VAR convertUrl>" target="_blank"><TMPL_VAR convertSource></a> のデータを表示しています。
    </aside></TMPL_IF>
    
    <article>
      <div id="area-name" class="color-set">
        <h1 id="character-name"><TMPL_IF aka><span id="aka">“<TMPL_VAR aka>”</span></TMPL_IF><TMPL_VAR characterName></h1>
        <div>
        <p id="update-time"><time><TMPL_VAR updateTime></time></p>
        <p id="player-name">プレイヤー：<TMPL_VAR playerName></p>
        </div>
      </div>
      
      <div id="tags">
        <TMPL_IF group><a id="group" href="./?group=<TMPL_VAR group>"><TMPL_VAR groupName></a></TMPL_IF>
        <TMPL_LOOP AreaTags><i class="stage"><TMPL_VAR TEXT></i></TMPL_LOOP>
        <TMPL_LOOP Tags><a class="tag" href="./?tag=<TMPL_VAR URL>"><TMPL_VAR TEXT></a></TMPL_LOOP>
      </div>
      <div class="column column-status"><!-- COLUMN -->
        <div id="area-profile">
          <TMPL_IF image>
          <div id="image" class="image" style="background-image: url(<TMPL_VAR imageSrc>);background-size:<TMPL_VAR imageFit>;background-position:<TMPL_VAR imagePositionX>% <TMPL_VAR imagePositionY>%;">
          <div onclick="popImage()"><p class="words" style="<TMPL_VAR wordsX><TMPL_VAR wordsY>"><TMPL_VAR words></p></div>
          <p class="image-copyright"><TMPL_VAR imageCopyright></p>
          </div>
          <TMPL_ELSE>
          <div id="image-none" class="image-none" data-title="GRANCREST"><p class="words" style="<TMPL_VAR wordsX><TMPL_VAR wordsY>"><TMPL_VAR words></p></div>
          </TMPL_IF>
          
          <div class="box-union" id="personal">
            <dl class="box" id="country">
              <dt>所属国
              <dd><TMPL_VAR country DEFAULT="――">
            </dl>
            <dl class="box" id="gender">
              <dt>性別
              <dd><TMPL_VAR gender>
            </dl>
            <dl class="box" id="age">
              <dt>年齢
              <dd><TMPL_VAR age>
            </dl>
            <dl class="box" id="height">
              <dt>身長
              <dd><TMPL_VAR height>
            </dl>
            <dl class="box" id="weight">
              <dt>体重
              <dd><TMPL_VAR weight>
            </dl>
          </div>

          <div class="box-union" id="class-and-style">
            <dl class="box" id="class">
              <dt>クラス
              <dd><TMPL_VAR class>
            </dl>
            <dl class="box" id="style">
              <dt>スタイル
              <dd><TMPL_VAR style>
            </dl>
            <dl class="box" id="works">
              <dt>ワークス
              <dd><TMPL_VAR works>
            </dl>
            <dl class="box" id="style-sub">
              <dt>サブスタイル
              <dd><TMPL_VAR styleSub DEFAULT="―――">
            </dl>
            <dl class="box" id="level">
              <dt>レベル
              <dd><TMPL_VAR level>
            </dl>
          </div>

          <section class="box" id="lifepath">
            <h2>ライフパス</h2>
            <table class="data-table line-tbody">
              <tbody>
                <tr>
                  <th>出自表／<TMPL_VAR lifepathBirthType>
                <tr>
                  <td class="comment"><div><TMPL_VAR lifepathBirth></div>
              <tbody>
                <tr>
                  <th>経験表1／<TMPL_VAR lifepathExp1Type>
                <tr>
                  <td class="comment"><div><TMPL_VAR lifepathExp1></div>
              <tbody>
                <tr>
                  <th>経験表2／<TMPL_VAR lifepathExp2Type>
                <tr>
                  <td class="comment"><div><TMPL_VAR lifepathExp2></div>
            </table>
          </section>

          <section class="box" id="belief">
            <h2>信念</h2>
            <table class="data-table">
              <tbody>
                <tr>
                  <th>目的
                  <td class="comment"><div><TMPL_VAR beliefPurpose></div>
                <tr>
                  <th>禁忌
                  <td class="comment"><div><TMPL_VAR beliefTaboo></div>
                <tr>
                  <th><span class="thin">趣味嗜好</span>
                  <td class="comment"><div><TMPL_VAR beliefQuirk></div>
            </table>
          </section>

          <section class="box" id="bond">
            <h2>因縁</h2>
            <table class="data-table">
              <thead>
                <tr>
                  <th>対象
                  <th>関係
                  <th>感情<span class="small">(メイン/サブ)</span>
              <tbody>
                <TMPL_LOOP Bonds><tr>
                  <td class="name    "><TMPL_VAR NAME>
                  <td class="relation"><TMPL_VAR RELATION>
                  <td class="emotion ">
                    <TMPL_VAR EMOMAIN>
                    /
                    <TMPL_VAR EMOSUB>
                </TMPL_LOOP>
            </table>
          </section>
        </div>
        
        <div id="area-status">
          <div class="box-union" id="sub-status">
            <dl class="box" id="hp">
              <dt>ＨＰ<dd><TMPL_VAR sttHpMod><b><TMPL_VAR sttHpTotal></b>
            </dl>
            <dl class="box" id="mp">
              <dt>ＭＰ<dd><TMPL_VAR sttMpMod><b><TMPL_VAR sttMpTotal></b>
            </dl>
            <dl class="box" id="fate">
              <dt>天運<dd><TMPL_VAR sttFateMod><b><TMPL_VAR sttFateTotal></b>
            </dl>
            <dl class="box" id="init">
              <dt>行動値<dd><TMPL_VAR sttInitMod><b><TMPL_VAR sttInitTotal></b>
            </dl>
            <dl class="box" id="move-base">
              <dt><span class="small">移動力基本値</span><dd><TMPL_VAR sttMoveMod><b><TMPL_VAR sttMoveBase></b>
            </dl>
            <dl class="box" id="move">
              <dt>移動力<dd><b><TMPL_VAR sttMoveTotal></b>
            </dl>
          </div>

          <TMPL_IF Forces><div class="box" id="force-mod-check">
            <label class="check-button">
              <input type="checkbox" onchange="setForceMod()">
              <span>部隊修正</span>
            </label>
            <select id="force-position" onchange="setForceMod()"><option>フォワード<option>センター</select>
          </div></TMPL_IF>

          <dl class="box" id="exp">
            <dt>経験点<small>(残／計)</small>
            <dd><TMPL_VAR expRest> ／ <TMPL_VAR expTotal>
          </dl>

        <section class="box" id="status">
          <h2>能力<span class="total-only">基本</span>値</h2>
          <button class="open-button" onclick="toggleNote('status');" data-open="" data-text-open="内訳を確認" data-text-close="内訳を畳む"></button>
          <table class="data-table total-only">
            <tbody>
              <tr>
                <th>筋力<td><TMPL_VAR sttStrTotal>
                <th>反射<td><TMPL_VAR sttRefTotal>
                <th>感覚<td><TMPL_VAR sttPerTotal>
                <th>知力<td><TMPL_VAR sttIntTotal>
                <th>精神<td><TMPL_VAR sttMndTotal>
                <th>共感<td><TMPL_VAR sttEmpTotal>
          </table>

          <table class="data-table breakdown">
            <thead>
              <tr>
                <th>
                <th class="Str">筋力
                <th class="Ref">反射
                <th class="Per">感覚
                <th class="Int">知力
                <th class="Mnd">精神
                <th class="Emp">共感
            <tbody>
              <tr class="status-works">
                <th>ワークス修正
                <td><TMPL_VAR sttStrWorks>
                <td><TMPL_VAR sttRefWorks>
                <td><TMPL_VAR sttPerWorks>
                <td><TMPL_VAR sttIntWorks>
                <td><TMPL_VAR sttMndWorks>
                <td><TMPL_VAR sttEmpWorks>
              <tr class="status-make">
                <th>作成時ボーナス
                <td><TMPL_VAR sttStrMake>
                <td><TMPL_VAR sttRefMake>
                <td><TMPL_VAR sttPerMake>
                <td><TMPL_VAR sttIntMake>
                <td><TMPL_VAR sttMndMake>
                <td><TMPL_VAR sttEmpMake>
              <tr class="status-grow-total">
                <th>成長合計
                <td><TMPL_VAR sttStrGrow>
                <td><TMPL_VAR sttRefGrow>
                <td><TMPL_VAR sttPerGrow>
                <td><TMPL_VAR sttIntGrow>
                <td><TMPL_VAR sttMndGrow>
                <td><TMPL_VAR sttEmpGrow>
              <tr class="status-other">
                <th>その他の修正
                <td><TMPL_VAR sttStrMod>
                <td><TMPL_VAR sttRefMod>
                <td><TMPL_VAR sttPerMod>
                <td><TMPL_VAR sttIntMod>
                <td><TMPL_VAR sttMndMod>
                <td><TMPL_VAR sttEmpMod>
              <tr class="status-total">
                <th>能力基本値
                <td><TMPL_VAR sttStrTotal>
                <td><TMPL_VAR sttRefTotal>
                <td><TMPL_VAR sttPerTotal>
                <td><TMPL_VAR sttIntTotal>
                <td><TMPL_VAR sttMndTotal>
                <td><TMPL_VAR sttEmpTotal>
              <tr class="status-divide">
                <th>
                <td colspan="6">÷3
              <tr  class="status-check-base">
                <th>判定基本値
                <td><TMPL_VAR sttStrCheckBase>
                <td><TMPL_VAR sttRefCheckBase>
                <td><TMPL_VAR sttPerCheckBase>
                <td><TMPL_VAR sttIntCheckBase>
                <td><TMPL_VAR sttMndCheckBase>
                <td><TMPL_VAR sttEmpCheckBase>
              <tr class="status-style">
                <th>スタイル修正
                <td><TMPL_VAR sttStrStyle>
                <td><TMPL_VAR sttRefStyle>
                <td><TMPL_VAR sttPerStyle>
                <td><TMPL_VAR sttIntStyle>
                <td><TMPL_VAR sttMndStyle>
                <td><TMPL_VAR sttEmpStyle>
              <tr class="status-check-total">
                <th>判定値
                <td><TMPL_VAR sttStrCheckTotal>
                <td><TMPL_VAR sttRefCheckTotal>
                <td><TMPL_VAR sttPerCheckTotal>
                <td><TMPL_VAR sttIntCheckTotal>
                <td><TMPL_VAR sttMndCheckTotal>
                <td><TMPL_VAR sttEmpCheckTotal>
            </tbody>
          </table>
        </section>
      </div>

        <section class="box" id="skill">
          <h2>技能</h2>
          <table class="data-table">
            <thead>
              <tr>
                <th>筋力<span class="small">技能</span><td>判定値<b id="str-check-value"><TMPL_VAR sttStrCheckTotal></b>
                <th>反射<span class="small">技能</span><td>判定値<b id="ref-check-value"><TMPL_VAR sttRefCheckTotal></b>
                <th>感覚<span class="small">技能</span><td>判定値<b id="per-check-value"><TMPL_VAR sttPerCheckTotal></b>
                <th>知力<span class="small">技能</span><td>判定値<b id="int-check-value"><TMPL_VAR sttIntCheckTotal></b>
                <th>精神<span class="small">技能</span><td>判定値<b id="mnd-check-value"><TMPL_VAR sttMndCheckTotal></b>
                <th>共感<span class="small">技能</span><td>判定値<b id="emp-check-value"><TMPL_VAR sttEmpCheckTotal></b>
            <tbody>
              <tr>
                <TMPL_LOOP Skills><td colspan="2">
                  <TMPL_LOOP Rows><dl class="left"><dt><TMPL_VAR LABEL><dd><TMPL_VAR LV></dl>
                  </TMPL_LOOP>
                  </dl>
                </TMPL_LOOP>
            </tbody>
          </table>
        </section>
      </div><!-- / COLUMN -->

      <div class="column column-abilities"><!-- COLUMN -->
        <section class="box" id="class-ability">
          <h2>クラス特技</h2>
          <button class="open-button" onclick="toggleNote('class-ability');" data-open="" data-text-open="効果を全展開" data-text-close="効果を折畳む"></button>
          <table class="data-table line-tbody ability-table">
            <colgroup>
              <col class="name  ">
              <col class="type  ">
              <col class="lv    ">
              <col class="timing">
              <col class="check ">
              <col class="target">
              <col class="range ">
              <col class="dfclty">
              <col class="cost  ">
              <col class="mc    ">
            </colgroup>
            <thead>
              <tr>
                <th class="name  ">特技名
                <th class="type  ">種別
                <th class="lv    "><span class="small">レベル</span>
                <th class="timing">タイミング
                <th class="check ">判定
                <th class="target">対象
                <th class="range ">射程
                <th class="dfclty">目標値
                <th class="cost  ">コスト
                <th class="mc    ">MC
            <TMPL_LOOP ClassAbilities><tbody>
              <tr>
                <td class="name  " rowspan="2"><TMPL_VAR NAME>
                <td class="type  "><TMPL_VAR TYPE>
                <td class="lv    "><TMPL_VAR LV>
                <td class="timing"><TMPL_VAR TIMING>
                <td class="check "><TMPL_VAR CHECK>
                <td class="target"><TMPL_VAR TARGET>
                <td class="range "><TMPL_VAR RANGE>
                <td class="dfclty"><TMPL_VAR DFCLTY>
                <td class="cost  "><TMPL_VAR COST>
                <td class="mc    "><TMPL_VAR MC>
              <tr>
                <td class="note" colspan="9"><div><TMPL_VAR NOTE></div>
            </TMPL_LOOP>
          </table>
        </section>

        <section class="box" id="works-ability">
          <h2>ワークス特技</h2>
          <button class="open-button" onclick="toggleNote('works-ability')" data-open="" data-text-open="効果を全展開" data-text-close="効果を折畳む"></button>
          <table class="data-table line-tbody ability-table">
            <colgroup>
              <col class="name  ">
              <col class="type  ">
              <col class="lv    ">
              <col class="timing">
              <col class="check ">
              <col class="target">
              <col class="range ">
              <col class="dfclty">
              <col class="cost  ">
            </colgroup>
            <thead>
              <tr>
                <th class="name  ">特技名
                <th class="type  ">種別
                <th class="lv    "><span class="small">レベル</span>
                <th class="timing">タイミング
                <th class="check ">判定
                <th class="target">対象
                <th class="range ">射程
                <th class="dfclty">目標値
                <th class="cost  ">コスト
            <TMPL_LOOP WorksAbilities><tbody>
              <tr>
                <td class="name  " rowspan="2"><TMPL_VAR NAME>
                <td class="type  "><TMPL_VAR TYPE>
                <td class="lv    "><TMPL_VAR LV>
                <td class="timing"><TMPL_VAR TIMING>
                <td class="check "><TMPL_VAR CHECK>
                <td class="target"><TMPL_VAR TARGET>
                <td class="range "><TMPL_VAR RANGE>
                <td class="dfclty"><TMPL_VAR DFCLTY>
                <td class="cost  "><TMPL_VAR COST>
              <tr>
                <td class="note" colspan="8"><TMPL_VAR NOTE>
            </TMPL_LOOP>
          </table>
        </section>

        <TMPL_IF Magics><section class="box" id="magic">
          <h2>魔法</h2>
          <button class="open-button" onclick="toggleNote('magic')" data-open="" data-text-open="効果を全展開" data-text-close="効果を折畳む"></button>
          <table class="data-table line-tbody ability-table">
            <colgroup>
              <col class="name    ">
              <col class="type    ">
              <col class="lv      ">
              <col class="duration">
              <col class="timing  ">
              <col class="check   ">
              <col class="target  ">
              <col class="range   ">
              <col class="dfclty  ">
              <col class="cost    ">
              <col class="mc      ">
            </colgroup>
            <thead>
              <tr>
                <th class="name    ">魔法名
                <th class="type    ">種別
                <th class="lv    "><span class="small">レベル</span>
                <th class="duration"><span class="small">効果時間</span>
                <th class="timing  ">タイミング
                <th class="check   ">判定
                <th class="target  ">対象
                <th class="range   ">射程
                <th class="dfclty  ">目標値
                <th class="cost    ">コスト
                <th class="mc      ">MC
            <TMPL_LOOP Magics><tbody>
              <tr>
                <td class="name    " rowspan="2"><TMPL_VAR NAME>
                <td class="type    "><TMPL_VAR TYPE>
                <td class="lv      "><TMPL_VAR LV>
                <td class="duration"><TMPL_VAR DURATION>
                <td class="timing  "><TMPL_VAR TIMING>
                <td class="check   "><TMPL_VAR CHECK>
                <td class="target  "><TMPL_VAR TARGET>
                <td class="range   "><TMPL_VAR RANGE>
                <td class="dfclty  "><TMPL_VAR DFCLTY>
                <td class="cost    "><TMPL_VAR COST>
                <td class="mc      "><TMPL_VAR MC>
              <tr>
                <td class="note" colspan="10"><TMPL_VAR NOTE>
            </TMPL_LOOP>
          </table>
        </section></TMPL_IF>
        <script>
        let opened = {
          "table":false,
          "class-ability":<TMPL_VAR classAbilityNoteOpen DEFAULT="false" />,
          "works-ability":<TMPL_VAR worksAbilityNoteOpen DEFAULT="false" />,
          "magic":<TMPL_VAR magicNoteOpen DEFAULT="false" />,
        };
        function toggleNote(type){
          opened[type] = !opened[type];
          document.getElementById(type).dataset.fullOpen = opened[type] ? 'true' : '';
          document.querySelector(`#${type} .open-button`).dataset.open = opened[type] ? 'true' : '';
        }
        </script>

        <dl class="box" id="max-weight">
          <dt>アイテム所持可能重量
          <dd><TMPL_VAR totalWeight> / <TMPL_VAR sttMaxWeight> 
        </dl>

        <section class="box" id="weapons">
          <h2>装備品：武器</h2>
          <table class="data-table item-table">
            <colgroup>
              <col class="category">
              <col class="name    ">
              <col class="type    ">
              <col class="weight  ">
              <col class="skill   ">
              <col class="acc     ">
              <col class="atk     ">
              <col class="init    ">
              <col class="move    ">
              <col class="range   ">
              <col class="guard   ">
              <col class="note    ">
            </colgroup>
            <thead>
              <tr>
                <th class="category">
                <th class="name    ">
                <th class="type    ">種別
                <th class="weight  ">重量
                <th class="skill   ">技能
                <th class="acc     "><span class="small">命中<br>修正</span>
                <th class="atk     ">攻撃力
                <th class="init    "><span class="small">行動<br>修正</span>
                <th class="move    "><span class="small">移動<br>修正</span>
                <th class="range   ">射程
                <th class="guard   "><span class="small">ガード<br>値</span>
                <th class="note left">効果
            </thead>
            <tbody>
              <TMPL_LOOP Weapons><tr id="weapon-row-<TMPL_VAR ID>">
                <th class="category"><TMPL_VAR CATEGORY>
                <td class="name    "><TMPL_VAR NAME>
                <td class="type    "><TMPL_VAR TYPE>
                <td class="weight  "><TMPL_VAR WEIGHT>
                <td class="skill   "><TMPL_VAR SKILL>
                <td class="acc     "><TMPL_VAR ACC>
                <td class="atk     "><TMPL_VAR ATK></td>
                <td class="init    "><TMPL_VAR INIT>
                <td class="move    "><TMPL_VAR MOVE>
                <td class="range   "><TMPL_VAR RANGE>
                <td class="guard   "><TMPL_VAR GUARD>
                <td class="note    "><TMPL_VAR NOTE>
              </TMPL_LOOP>
          </table>
        </section>

        <section class="box" id="armors">
          <h2>装備品：防具</h2>
          <table class="data-table item-table">
            <colgroup>
              <col class="category">
              <col class="name    ">
              <col class="type    ">
              <col class="weight  ">
              <col class="eva     ">
              <col class="def     ">
              <col class="init    ">
              <col class="move    ">
              <col class="note    ">
            </colgroup>
            <thead>
              <tr>
                <th class="category">
                <th class="name    ">
                <th class="type    ">種別
                <th class="weight  ">重量
                <th class="eva     "><span class="small">回避<br>修正</span>
                <th class="def     ">防御力<br><span class="small">武器/炎熱/衝撃/体内</span>
                <th class="init    "><span class="small">行動<br>修正</span>
                <th class="move    "><span class="small">移動<br>修正</span>
                <th class="note left">効果
            </thead>
            <tbody>
              <TMPL_LOOP Armors><tr id="armor-row-<TMPL_VAR ID>">
                <th class="category"><TMPL_VAR CATEGORY>
                <td class="name    "><TMPL_VAR NAME>
                <td class="type    "><TMPL_VAR TYPE>
                <td class="weight  "><TMPL_VAR WEIGHT>
                <td class="eva     "><TMPL_VAR EVA>
                <td class="def     "><TMPL_VAR DEF>
                <td class="init    "><TMPL_VAR INIT>
                <td class="move    "><TMPL_VAR MOVE>
                <td class="note    "><TMPL_VAR NOTE>
              </TMPL_LOOP>
          </table>
        </section>

        <TMPL_IF displayVehicle><section class="box" id="vehicle">
          <h2>乗騎</h2>
          <table class="data-table item-table">
            <colgroup>
              <col class="name">
              <col class="atk ">
              <col class="acc ">
              <col class="eva ">
              <col class="def ">
              <col class="init">
              <col class="move">
              <col class="note">
            </colgroup>
            <thead>
              <tr>
                <th class="name">
                <th class="atk "><span class="small">攻撃<br>修正</span>
                <th class="acc "><span class="small">命中<br>修正</span>
                <th class="eva "><span class="small">回避<br>修正</span>
                <th class="def ">防御力<br><span class="small">武器/炎熱/衝撃/体内</span>
                <th class="init"><span class="small">行動<br>修正</span>
                <th class="move"><span class="small">移動<br>修正</span>
                <th class="note left">効果
            </thead>
            <tbody>
              <TMPL_LOOP Vehicles><tr id="vehicle-row-<TMPL_VAR ID>">
                <td class="name     "><TMPL_VAR NAME>
                <td class="atk      "><TMPL_VAR ATK>
                <td class="acc      "><TMPL_VAR ACC>
                <td class="eva      "><TMPL_VAR EVA>
                <td class="def      "><TMPL_VAR DEF>
                <td class="init     "><TMPL_VAR INIT>
                <td class="move     "><TMPL_VAR MOVE>
                <td class="note     "><TMPL_VAR NOTE>
              </TMPL_LOOP>
          </table>
        </section></TMPL_IF>

        <TMPL_IF Items><section class="box" id="items">
          <h2>その他アイテム</h2>
          <table class="data-table item-table">
            <colgroup>
              <col class="name    ">
              <col class="weight  ">
              <col class="quantity">
              <col class="note    ">
            </colgroup>
            <thead>
              <tr>
                <th class="name    ">
                <th class="weight  ">重量
                <th class="quantity">個数
                <th class="note left">効果
            </thead>
            <tbody>
              <TMPL_LOOP Items><tr>
                <td class="name    "><TMPL_VAR NAME>
                <td class="weight  "><TMPL_VAR WEIGHT>
                <td class="quantity"><TMPL_VAR QUANTITY>
                <td class="note    "><TMPL_VAR NOTE>
              </TMPL_LOOP>
              <tr>
                <th class="small">その他アイテム重量合計
                <td class="weight" colspan="2"><TMPL_VAR itemsTotalWeight>
                <td>
          </table>
        </section></TMPL_IF>

        <TMPL_IF Forces><section class="box" id="force">
          <h2>部隊</h2>
          <table class="data-table line-tbody item-table">
            <colgroup>
              <col class="check">
              <col class="name">
            </colgroup>
            <thead>
              <tr>
                <th class="name" rowspan="2" colspan="2">
                <th class="lv small" rowspan="2">レベル
                <th class="morale small" rowspan="2">士気
                <th class="stt " colspan="6"><span class="small">能力修正</span>
                <th class="sstt" colspan="3"><span class="small">副能力修正</span>
                <th class="def " rowspan="2"><span class="small">攻撃力</span>
                <th class="def " colspan="4"><span class="small">防御力</span>
              <tr>
                <th class="small">筋力
                <th class="small">反射
                <th class="small">感覚
                <th class="small">知力
                <th class="small">精神
                <th class="small">共感

                <th class="small">ＨＰ
                <th class="small">行動値
                <th class="small">移動力

                <th class="small">武器
                <th class="small">炎熱
                <th class="small">衝撃
                <th class="small">体内
            </thead>
            <TMPL_LOOP Forces><tbody id="force<TMPL_VAR NUM>">
              <tr>
                <td rowspan="2"><input type="radio" name="forceLead" onchange="setForceMod()" value="<TMPL_VAR NUM>" <TMPL_VAR CHECKED>>
                <td rowspan="2"><TMPL_VAR TYPE>
                <td class="lv    " rowspan="2"><TMPL_VAR LV>
                <td class="morale"><TMPL_VAR MORALE>
                <td class="str   "><TMPL_VAR STR>
                <td class="ref   "><TMPL_VAR REF>
                <td class="per   "><TMPL_VAR PER>
                <td class="int   "><TMPL_VAR INT>
                <td class="mnd   "><TMPL_VAR MND>
                <td class="emp   "><TMPL_VAR EMP>
                <td class="hp    "><TMPL_VAR HP>
                <td class="init  "><TMPL_VAR INIT>
                <td class="move  "><TMPL_VAR MOVE>
                <td class="atk   "><TMPL_VAR ATK>
                <td class="defw  "><TMPL_VAR DEFWEAPON>
                <td class="deff  "><TMPL_VAR DEFFIRE>
                <td class="defs  "><TMPL_VAR DEFSHOCK>
                <td class="defi  "><TMPL_VAR DEFINTERNAL>
              <TMPL_IF NOTE><tr>
                <td colspan="15" class="note"><TMPL_VAR NOTE>
              </TMPL_IF></TMPL_LOOP>
          </table>
        </section></TMPL_IF>
      </div><!-- / COLUMN -->

      <div><!-- COLUMN -->
        <TMPL_IF ActionSets><section class="box" id="action-sets">
          <h2>アクションセット</h2>
          <TMPL_LOOP ActionSets><div class="action-set-data">
            <div class="top-row">
              <dl class="name"><dt>名称<dd><span><TMPL_VAR NAME></span></dl>
              <dl class="ability"><dt>使用特技<dd>
                <dl>
                  <dt>マイナー<dd><TMPL_VAR MINOR>
                  <dt>メジャー<dd><TMPL_VAR MAJOR>
                  <dt>その他  <dd><TMPL_VAR OTHER>
                </dl>
              </dl>
              <dl class="check"><dt>判定<dd>
                <dl>
                  <dt>使用技能     <dd><TMPL_VAR SKILL>
                  <dt>ダイス       <dd><TMPL_VAR DICE><span class="f-mod dice bold"></span>
                  <dt>判定値+修正値<dd><TMPL_VAR CHECK><span class="f-mod check bold" data-stt="<TMPL_VAR STT>"></span>
                  <dt>目標値       <dd><TMPL_VAR DFCLTY>
                </dl>
              </dl>
            </div>
            <div class="bottom-row">
              <dl class="target"><dt>対象    <dd><TMPL_VAR TARGET></dl>
              <dl class="range "><dt>射程    <dd><TMPL_VAR RANGE></dl>
              <dl class="mc    "><dt>MC      <dd><TMPL_VAR MC></dl>
              <dl class="cost  "><dt>コスト  <dd><TMPL_VAR COST></dl>
              <dl class="dmg   "><dt>ダメージ<dd><TMPL_VAR DMG><span class="f-mod dmg bold"></span></dl>
              <dl class="note  "><dt>効果    <dd><TMPL_VAR NOTE></dl>
            </div>
          </div></TMPL_LOOP>
        </section></TMPL_IF>
        <TMPL_IF ReactionSets><section class="box" id="reaction-sets">
          <h2>リアクションセット</h2>
          <TMPL_LOOP ReactionSets><div class="action-set-data">
            <div class="top-row">
              <dl class="name"><dt>名称<dd><span><TMPL_VAR NAME></span></dl>
              <dl class="ability"><dt>使用特技<dd>
                <dl>
                  <dt>リアクション<dd><TMPL_VAR REACTION>
                  <dt>その他      <dd><TMPL_VAR OTHER>
                </dl>
              </dl>
              <dl class="check"><dt>判定<dd>
                <dl>
                  <dt>使用技能     <dd><TMPL_VAR SKILL>
                  <dt>ダイス       <dd><TMPL_VAR DICE><span class="f-mod dice bold"></span>
                  <dt>判定値+修正値<dd><TMPL_VAR CHECK><span class="f-mod check bold" data-stt="<TMPL_VAR STT>"></span>
                  <dt>目標値       <dd><TMPL_VAR DFCLTY>
                </dl>
              </dl>
            </div>
            <div class="bottom-row">
              <dl class="mc    "><dt>MC      <dd><TMPL_VAR MC></dl>
              <dl class="cost  "><dt>コスト  <dd><TMPL_VAR COST></dl>
              <dl class="note  "><dt>効果    <dd><TMPL_VAR NOTE></dl>
            </div>
          </div></TMPL_LOOP>
        </section></TMPL_IF>
      </div><!-- / COLUMN -->
      
      <section class="box" id="free-note">
        <h2><TMPL_IF head_freeNote><TMPL_VAR head_freeNote><TMPL_ELSE>設定・メモ</TMPL_IF></h2>
        <p><TMPL_VAR freeNote></p>
      </section>
      <TMPL_IF freeHistory>
      <section class="box" id="free-history">
        <h2><TMPL_IF head_freeHistory><TMPL_VAR head_freeHistory><TMPL_ELSE>履歴</TMPL_IF></h2>
        <p><TMPL_VAR freeHistory></p>
      </section>
      </TMPL_IF>
      <section class="box" id="history">
        <h2>セッション履歴</h2>
        <table class="data-table line-tbody">
          <thead>
            <tr>
              <th class="num   ">No.
              <th class="date  ">日付
              <th class="title ">タイトル
              <th class="exp   ">経験点
              <th class="gm    ">GM
              <th class="member">参加者
            </tr>
          </thead>
          <TMPL_LOOP History><tbody>
            <tr>
              <td class="num   " <TMPL_IF NOTE>rowspan="2"</TMPL_IF>><TMPL_VAR NUM></td>
              <td class="date  " <TMPL_IF NOTE>rowspan="2"</TMPL_IF>><TMPL_VAR DATE></td>
              <td class="title " <TMPL_IF NOTE>rowspan="2"</TMPL_IF>><TMPL_VAR TITLE></td>
              <td class="exp   "><TMPL_VAR EXP></td>
              <td class="gm    "><span><TMPL_VAR GM></span></td>
              <td class="member"><TMPL_VAR MEMBER></td>
            </tr>
            <TMPL_IF NOTE><tr><td colspan="6" class="note"><TMPL_VAR NOTE></TMPL_IF>
          </TMPL_LOOP>
          <tfoot>
            <tr>
              <td>
              <td>
              <td>取得総計
              <td><TMPL_VAR historyExpTotal>
              <td colspan="2">
            </tr>
          </tfoot>
        </table>
      </section>
      <TMPL_IF cashbook>
      <section class="box" id="cashbook">
        <h2><TMPL_IF head_cashbook><TMPL_VAR head_cashbook><TMPL_ELSE>収支履歴</TMPL_IF></h2>
        <div><p><TMPL_VAR cashbook></p></div>
      </section>
      </TMPL_IF>
      <section class="box chat-palette float-box">
        <h2>チャットパレット</h2>
        <div class="chat-palette-menu">
          <b>使用ツール:</b>
          <a onclick="chatPaletteSelect('')"       id="cp-switch-ytc">ゆとチャadv.</a>
          <a onclick="chatPaletteSelect('tekey')"  id="cp-switch-tekey">Tekey</a>
          <a onclick="chatPaletteSelect('bcdice')" id="cp-switch-bcdice">他BCDice系</a>
        </div>
        <textarea id="chatPaletteBox"></textarea>
      </section>
    </article>
    <div class="back-button"><a href="./">⏎</a></div>
    <TMPL_IF image><div id="image-box" onclick="closeImage()">
      <img src="<TMPL_VAR imageSrc>" id="image-box-image">
    </div></TMPL_IF> 
  </main>
  <TMPL_INCLUDE NAME="skin-add/sheet-sidebar.html">

  <footer>
    <p class="notes">©Shunsaku Yano/Team Barrelroll.「グランクレストRPG」</p>
    <p class="copyright">©<a href="https://yutorize.2-d.jp">ゆとらいず工房</a>「ゆとシートⅡ」ver.<TMPL_VAR ver></p>
  </footer>
</body>

</html>
